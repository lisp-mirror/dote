;; dawn of the Era: a tactical game.
;; Copyright (C) 2015  cage

;; This program is free software: you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.

(in-package :interpolation-test)

(defsuite interpolation-suite (all-suite))

(defun hermite-2d ()
  (let ((k0 (sb-cga:vec  0.0  0.0 0.0))
	(k1 (sb-cga:vec  10.0 10.0 0.0))
	(k2 (sb-cga:vec 10.0 -20.0 0.0))
	(k3 (sb-cga:vec 0.0 0.0 0.0)))
    (alexandria:flatten
     (loop for i from 0.0 to 1.0 by 0.01 collect
	  (let* ((res (hermite-polynomial k0 k1 k2 k3 i))
		 (a   (matrix:matrix-elt res 0 0))
		 (b   (matrix:matrix-elt res 1 0)))
	    (list a b))))))


(defun c-m-interpolation ()
  (let* ((knots (list (vec  0.0  0.0 0.0)
		      (vec 10.0 10.0 0.0)
		      (vec 20.0	 5.0 0.0)
		      (vec 10.0  0.0 0.0)
		      (vec  0.0  0.0 0.0)))
	 (interpolator (catmul-roll-interpolation* knots)))
    (alexandria:flatten
     (loop for i from 0.0 to 5.0 by 0.01 collect
	  (let* ((res (funcall interpolator i))
		 (a   (matrix:matrix-elt res 0 0))
		 (b   (matrix:matrix-elt res 1 0)))
	    (list a b))))))

(deftest test-c-m-interpolation (interpolation-suite)
  (assert-true
      (equalp (c-m-interpolation)
	      (list 0.0 0.0
		    0.0029799999 0.003475
		    0.011839999 0.013799999
		    0.026460001 
		    0.030825  0.046719998 0.054399997
		    0.07249999 0.08437499
		    0.103679985 0.120599985
		    0.14013997 0.16292496
		    0.18175995 0.21119994
		    0.22841993 0.2652749
		    0.2799999
		    0.3249999 0.3363799
		    0.39022487 0.39743987
		    0.46079984 0.46305987
		    0.53657484
		    0.5331199 0.61739993
		    0.60749996 0.70312494
		    0.6860799 0.7935999
		    0.76874006
		    0.8886751 0.85536003
		    0.98820007 0.94582015
		    1.0920252 1.0400002
		    1.2000003
		    1.1377801 1.3119751
		    1.2390401 1.4278002
		    1.3436604 1.5473254
		    1.4515203
		    1.6704004 1.5625002
		    1.7968752 1.6764802
		    1.9266002 1.7933402
		    2.059425 1.91296
		    2.1952 2.0352197
		    2.3337746 2.1599998
		    2.475 2.2871797
		    2.6187246 2.4166396
		    2.7647996 2.5482595
		    2.9130745 2.6819193
		    3.0633993 2.8174994
		    3.2156243 2.954879
		    3.3695989 3.0939386
		    3.5251734 3.2345583
		    3.682198 3.3766186
		    3.8405235 3.519998
		    3.9999979 3.6645782
		    4.160473 3.810238
		    4.321798 3.956858
		    4.483823 4.1043177
		    4.6463976 4.2524977
		    4.8093724 4.4012775
		    4.972597 4.5505376
		    5.1359224 4.700157
		    5.2991967 4.850017
		    5.4622717 4.999997
		    5.624997 5.149977
		    5.787222 5.2998376
		    5.948797 5.449457
		    6.109572 5.598717
		    6.269397 5.7474957
		    6.4281206 5.8956766
		    6.5855966 6.0431366
		    6.7416716 6.1897564
		    6.8961964 6.335416
		    7.049021 6.4799957
		    7.1999955 6.623377
		    7.348972 6.765435
		    7.4957952 6.906056
		    7.640321 7.0451164
		    7.7823963 7.1824956
		    7.92187 7.318075
		    8.058595 7.4517355
		    8.192421 7.5833554
		    8.323195 7.7128153
		    8.45077 7.8399944
		    8.574994 7.9647756
		    8.695721 8.087034
		    8.812795 8.2066555
		    8.926071 8.323516
		    9.035397 8.437496
		    9.140621 8.548476
		    9.241596 8.656336
		    9.338171 8.760956
		    9.430197 8.862215
		    9.517521 8.959995
		    9.599996 9.054175
		    9.677471 9.144635
		    9.749796 9.2312565
		    9.816822 9.313916
		    9.878397 9.392496
		    9.934372 9.466875
		    9.984596 9.536935
		    10.028921 9.602556
		    10.067198 9.663616
		    10.099273 9.719996
		    10.124998 9.771576
		    10.144222 9.818239
		    10.156801 9.859858
		    10.162575 9.896318
		    10.161401 9.9275
		    10.153128 9.953278
		    10.1376 9.973537
		    10.1146755 9.98816
		    10.084203 9.99702
		    10.046028 10.000001
		    10.000004 10.00397
		    9.949756 10.015759
		    9.899024 10.035189
		    9.84782 10.062078
		    9.796163 10.096248
		    9.744066 10.137517
		    9.691544 10.185707
		    9.638612 10.240636
		    9.585284 10.302125
		    9.531576 10.369995
		    9.477504 10.444064
		    9.423081 10.524155
		    9.368325 10.610085
		    9.313247 10.7016735
		    9.257865 10.798742
		    9.202192 10.901112
		    9.146244 11.008601
		    9.090036 11.121032
		    9.033584 11.23822
		    8.976901 11.35999
		    8.920006 11.486159
		    8.862906 11.6165495
		    8.805624 11.750978
		    8.748171 11.889269
		    8.690565 12.031238
		    8.632818 12.176707
		    8.5749445 12.325499
		    8.516963 12.477427
		    8.458885 12.632317
		    8.400728 12.789986
		    8.342505 12.950255
		    8.284233 13.112945
		    8.2259245 13.277875
		    8.167599 13.444864
		    8.109265 13.613734
		    8.050943 13.784304
		    7.9926453 13.956393
		    7.9343877 14.129823
		    7.8761854 14.304414
		    7.8180532
		    14.479982 7.760006
		    14.656353 7.7020583
		    14.833342 7.644226
		    15.010773 7.5865235
		    15.188461 7.528966
		    15.366232 7.4715686
		    15.543901 7.4143457
		    15.721292 7.357313
		    15.898221 7.300486
		    16.074512 7.243879
		    16.24998 7.187506
		    16.42445 7.1313834
		    16.59774 7.075526
		    16.769672 7.0199485
		    16.940062 6.9646664
		    17.10873 6.9096937
		    17.275501 6.8550463
		    17.440191 6.8007393
		    17.602621 6.7467856
		    17.762611
		    6.6932034 17.919983
		    6.640006 18.074553
		    6.5872087 18.226143
		    6.5348263 18.374573
		    6.482874 18.51966
		    6.431366 18.661232
		    6.380319 18.799103
		    6.3297462 18.933094
		    6.2796636 19.063025
		    6.230086 19.188713
		    6.181029 19.309984
		    6.1325064 19.426655
		    6.0845337 19.538546
		    6.037126 19.645475
		    5.9902987 19.747267
		    5.944066 19.843737
		    5.8984437 19.93471
		    5.853446 20.019999
		    5.8090878 20.099428
		    5.765386 20.172821
		    5.722353 20.239992
		    5.680006 20.300762
		    5.638358 20.354956
		    5.597425 20.402384
		    5.557223 20.442875
		    5.517765 20.476248
		    5.4790673 20.502316
		    5.441145 20.520906
		    5.404012 20.531841
		    5.3676844 20.53493
		    5.332178 20.530003
		    5.2975044 20.51687
		    5.2636824 20.495361
		    5.2307253 20.465294
		    5.198647 20.426487
		    5.1674643 20.378756
		    5.1371922 20.321932
		    5.107844 20.255821
		    5.0794363 20.18025
		    5.051984 20.095045
		    5.025501 20.000015
		    5.000004 19.899025
		    4.9740114 19.796095
		    4.946064 19.691286
		    4.9162073 19.584656
		    4.884485 19.476265
		    4.850942 19.366177
		    4.815625 19.254446
		    4.778578 19.141138
		    4.739846 19.026308
		    4.699474 18.910019
		    4.657507 18.792326
		    4.613989 18.673298
		    4.568967 18.55299
		    4.5224853 18.431458
		    4.4745874 18.308771
		    4.4253206 18.184978
		    4.3747277 18.06015
		    4.322856 17.934341
		    4.2697487 17.80761
		    4.2154512 17.680021
		    4.1600094 17.55163
		    4.1034665 17.4225
		    4.0458694 17.292692
		    3.9872622 17.162262
		    3.92769 17.031273
		    3.8671978 16.89978
		    3.80583 16.767853
		    3.7436333 16.635544
		    3.680651 16.502914
		    3.6169286 16.370024
		    3.5525112 16.23693
		    3.4874434 16.103703
		    3.4217715 15.970393
		    3.355539 15.837064
		    3.288792 15.703774
		    3.2215745 15.570583
		    3.153932 15.437554
		    3.0859098 15.304745
		    3.0175524
		    15.1722145 2.948905
		    15.040024 2.8800125
		    14.908234 2.81092
		    14.776904 2.7416728
		    14.646094 2.6723154
		    14.515863 2.6028929
		    14.386274 2.5334504
		    14.257383 2.464033
		    14.129253 2.3946855
		    14.001944 2.325453
		    13.875513 2.2563806
		    13.750024 2.187513
		    13.625533 2.1188955
		    13.502104 2.0505733
		    13.379795 1.9825909
		    13.258663
		    1.9149932 13.138773
		    1.8478254 13.020184
		    1.7811332 12.902954
		    1.7149608
		    12.787142 1.6493527
		    12.672813 1.5843556
		    12.560022 1.520013
		    12.448832 1.45637
		    12.339302 1.3934724
		    12.231492 1.3313651
		    12.125462 1.2700922
		    12.021271
		    1.2096996 11.918982
		    1.1502323 11.818651
		    1.0917348 11.720339
		    1.0342516 11.62411
		    0.9778293 11.53002
		    0.9225115 11.438129
		    0.8683439 11.348498
		    0.81537104
		    11.2611885 0.7636385
		    11.176258 0.7131908
		    11.093767 0.664073
		    11.013777
		    0.61632985 10.936347
		    0.57000786 10.861535
		    0.52514935 10.789406
		    0.481802
		    10.7200165 0.44000953
		    10.653424 0.39981604
		    10.589695 0.36126867
		    10.528882
		    0.32441005 10.471052
		    0.28928727 10.416263
		    0.25594518 10.364571
		    0.22442684
		    10.31604 0.19477859
		    10.270729 0.1670456
		    10.228699 0.14127299
		    10.190008
		    0.117505044 10.154718
		    0.09578779 10.122887
		    0.076164305 10.094577
		    0.058681667
		    10.069846 0.04338354
		    10.048755 0.03031537
		    10.031364 0.01952231
		    10.017735
		    0.011049956 10.007922
		    0.004941374 10.001991
		    0.0012432039 10.0
		    0.0 9.997022
		    0.0
		    9.988163 0.0
		    9.973544 0.0
		    9.953285 0.0
		    9.927507 0.0
		    9.896328 0.0
		    9.859869 0.0
		    9.818251 0.0
		    9.771592 0.0
		    9.720013 0.0
		    9.663635 0.0
		    9.602575 0.0
		    9.536957 0.0
		    9.466898 0.0
		    9.392519 0.0
		    9.31394 0.0
		    9.231282 0.0
		    9.144663 0.0
		    9.054204 0.0
		    8.960025 0.0
		    8.862246 0.0
		    8.760987 0.0
		    8.656367 0.0
		    8.548509 0.0
		    8.43753 0.0
		    8.323551 0.0
		    8.206691 0.0
		    8.087072 0.0
		    7.964813 0.0
		    7.840033 0.0
		    7.7128544 0.0
		    7.583395 0.0
		    7.4517756 0.0
		    7.318116 0.0
		    7.182537 0.0
		    7.0451574 0.0
		    6.9060984
		    0.0 6.765479
		    0.0 6.623419
		    0.0 6.48004
		    0.0 6.3354607
		    0.0 6.1898003
		    0.0 6.043181
		    0.0 5.895722
		    0.0 5.747542
		    0.0 5.598762
		    0.0 5.4495025
		    0.0 5.299883
		    0.0
		    5.1500225 0.0
		    5.000043 0.0
		    4.850063 0.0
		    4.700203 0.0
		    4.550583 0.0
		    4.401324 0.0
		    4.2525434 0.0
		    4.1043634 0.0
		    3.9569032 0.0
		    3.8102822 0.0
		    3.6646225 0.0
		    3.520043
		    0.0 3.3766625
		    0.0 3.234602
		    0.0 3.0939817
		    0.0 2.9549217
		    0.0 2.8175414
		    0.0
		    2.6819606 0.0
		    2.5482993 0.0
		    2.4166799 0.0
		    2.287219 0.0
		    2.1600385 0.0
		    2.0352573
		    0.0 1.9129974
		    0.0 1.7933768
		    0.0 1.6765159
		    0.0 1.5625352
		    0.0 1.4515531
		    0.0
		    1.3436937 0.0
		    1.2390727 0.0
		    1.137811 0.0
		    1.0400295 0.0
		    0.9458494 0.0
		    0.85538745 0.0
		    0.7687664 0.0
		    0.6861043 0.0
		    0.6075251 0.0
		    0.5331433 0.0
		    0.4630816 0.0
		    0.39745927 0.0
		    0.33639908 0.0
		    0.28001785 0.0
		    0.228436 0.0
		    0.1817751 0.0
		    0.14015317 0.0
		    0.103690624 0.0
		    0.07250905 0.0
		    0.046727657 0.0
		    0.026466846 0.0
		    0.011843443 0.0
		    0.0029826164 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0 0.0
		    0.0
		    0.0 0.0 0.0))))
